<div class="container my-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold">Mis Mascotas</h2>
      <p class="text-muted">Gestiona el perfil de tus peludos</p>
    </div>

    <button class="btn btn-primary rounded-pill px-4" (click)="toggleForm()">
      @if (showForm()) {
      <i class="bi bi-x-lg"></i> Cancelar
      } @else {
      <i class="bi bi-plus-lg"></i> Nueva Mascota
      }
    </button>
  </div>

  @if (showForm()) {
  <div class="card border-0 shadow-sm p-4 mb-5 bg-light rounded-4">
    <div class="card-body">
      <h4 class="mb-4 text-primary">Registrar nueva mascota</h4>

      <form [formGroup]="petForm" (ngSubmit)="onSubmit()">
        <div class="row g-3">

          <div class="col-md-6">
            <label class="form-label fw-semibold">Nombre</label>
            <input type="text" class="form-control form-control-lg" formControlName="name"
              [class.is-invalid]="petForm.get('name')?.invalid && petForm.get('name')?.touched"
              placeholder="Ej: Firulais">
            @if(petForm.get('name')?.invalid && petForm.get('name')?.touched) {
            <div class="invalid-feedback">El nombre es obligatorio</div>
            }
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Fecha de Nacimiento</label>
            <input type="date" class="form-control form-control-lg" formControlName="birthDate"
              [class.is-invalid]="petForm.get('birthDate')?.invalid && petForm.get('birthDate')?.touched">
            @if(petForm.get('birthDate')?.invalid && petForm.get('birthDate')?.touched) {
            <div class="invalid-feedback">La fecha es necesaria</div>
            }
          </div>

          <div class="col-12">
            <label class="form-label fw-semibold">Foto URL (Opcional)</label>
            <input type="text" class="form-control" formControlName="photoUrl"
              placeholder="https://ejemplo.com/foto-perro.jpg">

            @if (petForm.get('photoUrl')?.value) {
            <div class="mt-3">
              <span class="d-block text-muted small mb-2">Vista previa:</span>
              <img [src]="petForm.get('photoUrl')?.value" class="rounded-3 shadow-sm"
                style="height: 100px; width: 100px; object-fit: cover;" alt="Preview">
            </div>
            }
          </div>
        </div>

        <div class="mt-4 text-end">
          <button type="submit" class="btn btn-success px-4 py-2 rounded-pill" [disabled]="petForm.invalid">
            Guardar Mascota
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  @if (pets().length > 0) {
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">

    @for (pet of pets(); track pet.id) {
    <div class="col">
      <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden">

        <div class="position-relative">
          <img
            [src]="pet.photoUrl || 'https://images.unsplash.com/photo-1543466835-00a7907e9de1?q=80&w=1000&auto=format&fit=crop'"
            class="card-img-top" style="height: 250px; object-fit: cover;" alt="{{ pet.name }}"
            onerror="this.src='https://images.unsplash.com/photo-1543466835-00a7907e9de1?q=80&w=1000&auto=format&fit=crop'">

          <span class="position-absolute top-0 end-0 m-3 badge bg-white text-dark shadow-sm rounded-pill">
            {{ calculateAge(pet.birthDate) }}
          </span>
        </div>

        <div class="card-body p-4">
          <h4 class="card-title fw-bold mb-1">{{ pet.name }}</h4>
          <p class="card-text text-muted small mb-3">
            Due√±o: {{ pet.owner }}
          </p>

          <hr class="text-muted opacity-25">

          <div class="d-flex justify-content-end">
            <button class="btn btn-outline-danger btn-sm rounded-pill px-3" (click)="deletePet(pet.id)">
              Eliminar
            </button>
          </div>
        </div>

      </div>
    </div>
    }

  </div>
  } @else {

  <div class="text-center py-5 my-5 bg-light rounded-4">
    <div class="mb-3">
      <h1 class="display-1 text-muted">üêæ</h1>
    </div>
    <h3 class="text-muted">No tienes mascotas registradas</h3>
    <p class="mb-4">¬°A√±ade a tu mejor amigo para empezar a cuidarlo!</p>
    <button class="btn btn-primary rounded-pill" (click)="toggleForm()">
      Registrar mi primera mascota
    </button>
  </div>

  }
</div>